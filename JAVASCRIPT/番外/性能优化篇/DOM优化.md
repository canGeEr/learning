# DOM优化
https://juejin.im/entry/58abed228d6d810058bee22f

## 在此之前的一些概念的解释

### DOM是什么
**DOM** 就是 **Document Object Model**，文档对象模型，里边是接口，即方法函数。我们通过调用并传指定参数来使用。
官方定义：**DOM是一个独立于语言的、用于操作XML和HTML文档的程序接口(API)**。在浏览器中主要用于与HTML文档打交道，并且使用DOM API用来访问文档中的数据。
DOM是个与ES语言无关的API，它在浏览器中的接口却是用JavaScript来实现的，DOM就成了现在JS编码中的重要部分。

## 为什么说JS操作DOM是非常消耗性能的(JS和DOM是两种东西)
ES通过DOM接口来获取文档中的元素。
正因为浏览器中通常把DOM和ECMAScript独立实现。使得二者相互独立，就像两座孤岛。
所以ES每次操作DOM时，ES和DOM之间就像两个桥之间需要过车辆。
每次链接就都需要搭建一个桥梁，搭桥还是小事，ES请求DOM的车辆过桥时，会经过一个收费站，每次都会被收费。JS引擎会消耗浏览器的性能进行缴费。
而车辆通过后桥就销毁，下次链接重新搭桥二次缴费。所以说JS与DOM每次连接都需要消耗性能 。
也正因此，有了每操作一次DOM就多做点事的理念，尽可能以最少的次数处理最多的DOM操作，以实现每过一次桥多拉点货的效果。
（VUE也正是这种理念，操作虚拟dom减少性能消耗，因此vue性能更优，另个话题来说。）

## 浏览器本身是有优化操作的
现代浏览器是相当完善的了，因为多次操作DOM会触发重排重绘、消耗性能。所以除了我们人为的、有意识的去控制操作DOM次数以外，浏览器在设计上进行了优化，也会智能的“节流”操作DOM，比如实现队列化修改、批量执行。

解释来说就是，浏览器会有一个“队列”，用以存放（攒着）需要操作DOM的js程序。每当执行一次js操作dom的代码，这个队列里就先暂存一个程序。等到一段时间后，浏览器再集中、批量的链接一次"ES岛"和"DOM岛"（就是让JS引擎去链接渲染引擎），进而触发一次DOM操作。你可以形象的理解为“过一段时间发一班车”。

但是我们人类感知不到啊，可能会因为误操作打断浏览器的“节流”步骤。迫使浏览器中断当前的“等待”，去赶紧、立马进行一次dom操作。让浏览器赶紧执行完他攒在“队列”里的JS操作DOM的程序后返回最新的DOM位置信息给我们。这就好像电梯门定时自动关闭，但是你却手动按了关门按钮强迫关门一样。

这种情况就发生在我们获取DOM信息的时候：

打断浏览器优化，强迫触发重排的属性：
offsetTop、offsetLeft、offsetWidth、offsetHeight
scrollTop、scrollLeft、scrollWidth、scrollHeight
clientTop、clientLeft、clientWidth、clientHeight
getComputedStyle()

因为要跟浏览器请求最新的DOM信息，所以浏览器就得赶紧让JS引擎去渲染引擎那里进行一次DOM操作。

## 对每次操作DOM的分析
1. 注意JS是单线程(当然现在可以多线程了)，负责管理DOM的是其它东西而不是JS，这就像连接数据库一样，在另一个地方是有对应的数据，但没一次的连接和查询都是极其消耗性能的
2. 

## 有以下几点需要注意：

1. 最小化DOM访问次数

2. 对于需要多次访问的DOM节点，使用局部变量存储其引用 

3. 如果要操作一个HTML元素集合，建议把它拷贝到一个数组中（getElement&&querySelect)

4. 留意重排和重绘的次数

5. 事件委托(事件冒泡，父节点绑定,注意只有某些事件可以)

