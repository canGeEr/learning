# 04-fs文件系统

## 同步和异步写入
- 同步的代码写入会阻塞程序的运行
- 异步的读写不会阻塞代码执行，但是它需要回调函数去处理结果

## 原始的文件读写
- fd = fs.openSync在内存中（把文件读入内存，是操作系统做的事情）打开文件，返回文件的操作对象
- fs.writeSync(fd, ...) 对文件进行一些操作读写
- fs.closeSync(fd) 关闭读写文件操作

## 简单的读写操作
> 简单的读写操作时基于原始文件读写的封装

- 读文件操作 readFile、readFileSync
- 写文件操作 writeFile、writeFileSync
- 删除文件操作 unlink、unlinkSync
- fs.stat、fs.statSync用于检测文件或者路径的信息（包括是否为目录）
- rmdir删除、mkdir创建 目录

## 实现递归的删除一个文件夹
```javascript
const fs = require('fs')
const path = require('path')
//深度递归遍历
//功能是删除该路径下的所有资源
function delDirDeep(filepath) {
    let stats = fs.statSync(filepath)
    if(stats) {//路径存在，判读是目录还是文件
        if(stats.isDirectory()) {
            let filenames = fs.readdirSync(filepath)
            for(let filename of filenames) {
                delDirDeep(path.join(filepath, filename))
            }
            fs.rmdirSync(filepath)
        }else if (stats.isFile()) {
            fs.unlinkSync(filepath)
        }
    }else {//该路径资源不存在
        console.log(filepath)
    }
}
```

## 流式文件的读写
我们如果把一个文件想象成一个容器，文件内容就是水一样，流就像一个管道        


### 为什么需要流
- 普通读写是对整个文件的读写，太消耗性能了
- 普通读写文件不适合大文件的读写

### 流式写入
如果我们创建一个文件的写入流，那么相当于给文件容器接了一根管道，我们可以持续的向管道里加水输送到文件中，这个过程叫做文件的流式写入
```javascript
const ws = fs.createWriteStream('a.txt')
ws.once('open', function() {
    console.log('写入流打开了')
})
ws.once('close', function() {
    console.log('写入流关闭了')
})
ws.write('这是一段文字\n')
ws.write('这是第二段文字\n')
ws.end() //关闭可写流
```

### 流式读取
```javascript
const rs = fs.createReadStream('a.txt')
rs.once('open', function() {
    console.log('可读流打开了')
})
rs.once('close', function() {
    console.log('可读流关闭了')
})
//rs不会自动的去读文件，只有绑定了data监听，才会自动的读取文件
rs.on('data', function(data) {//倒水开闸一样的开关
    console.log(data.toString())
})
```

### 组合流式读写
```javascript
const rs = fs.createReadStream('a.txt')
const ws = fs.createWriteStream('aClone.txt')
rs.on('data', function(data) {
    ws.write(data)
})
rs.once('close', function() {
    ws.end()//当可读流自动完成内容时，可写流也要自动的关闭
})
```
```javascript
const rs = fs.createReadStream('a.txt')
const ws = fs.createWriteStream('aClone.txt')
rs.pipe(ws)//将读文件流管道接向写文件管道，完成文件的赋值
```