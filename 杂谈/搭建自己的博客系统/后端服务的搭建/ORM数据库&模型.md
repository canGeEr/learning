# ORM <= 数据库和模型

## Mysql数据库

### （1）先说规范
- **名称规范：** 无论是数据库名，如blog_back_v2.0，数据表名user_title，数据表字段名cover_url都不是小驼峰命名，而是以下划线分割符。

- **软删除：** 为了方便数据找回，尽量数据库的删除操作都是软删除操作，至于数据库太多记录的特殊表进行定时任务的硬清除，如点赞表，收藏表。软删除需要一个字段status, enum类型，1表示可用，0无效。

- **描述记录的时间：** 为了数据库记录安全考虑，需要对记录的创建时间和更新时间进行记录，因此每张表和软删除一样都要create_time和update_time(勾选根据当前时间进行更新)，类型timestamp时间戳

- **字段长度：** 一般字段长度我会给 (2^n - 1) 位，一般10位的key键标识，注意外键也是10位，
url一般要毕竟长：127位，标题一般：63位，outline一小段文字给：127位，存储json给：255位


###  （2）数据表设计
- **多级分层：** 满足复杂的逻辑设计。比如权限管理可以用两张表：role，user表 user.role_id =
  role.id，让一张role来承担权力权限的设计，也会减轻user的存储压力
- **膨胀记录表：** 点赞、收藏类的功能都是通过加表完成，方便也简单，但是其数据量非常庞大，有要经常进行存取、更新，所以给其添加定时任务，将已经软删除的数据记录进行硬删除。


###  （3）今典的数据存储
  1. 大量的文档内容存储为文件 如 md、docx，需要细分upload_path表， file表，记录存取file.id就可
  2. 一对多的数据可以用json存储，或者用join(',')处理，一般更推荐第二种，便于语言迁移
  3. 图片存储，返回图片路径，直接存储url数据就好

## [Egg-sequlize](https://eggjs.org/zh-cn/tutorials/sequelize.html)模型

> 原框架：[sequelize](https://sequelize.org/)
### （1）为什么用模型
- 直接的方便了数据的增删改查，是对原生的sql语句的基础上进行了面对对象构架的封装。因此在操作数据库的时候非常方便就像是在面向API接口做数据库编程，当然这只是最基础的，其中还包括字段验证，数据回滚，数据临时恢复。
- 上手难度中等，主要是用过的人已经习惯了一套**面对对象构架的模型准则**所以感觉什么都简单，但是没用过的感觉很多概念名词都晦涩难懂，所以上手慢点，这也是为什么官方文档写的比较简陋的原因。

### （2）怎么用
- 官方说了一大堆，不过太麻烦，我不太喜欢数据库迁移那部分，所以选择了[sequelize-automate](https://www.npmjs.com/package/sequelize-automate)，直接生成model文件，放在app的model下，egg再配置相应的插件即可以正常使用了。